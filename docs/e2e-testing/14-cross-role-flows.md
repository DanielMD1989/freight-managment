# 14 - Cross-Role E2E Flows (CROSS-xxx)

> **Total Tests:** 8
> **Priority Breakdown:** P0: 4 | P1: 4 | P2: 0 | P3: 0
> **Description:** Multi-user, multi-role end-to-end scenarios testing the complete platform workflow

---

### CROSS-001: Full Happy Path (Shipper-to-Completion)

| Field               | Value                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**        | P0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Preconditions**   | All test users active, wallets funded, corridors configured, truck approved                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Steps**           | 1. **Shipper** creates load → DRAFT 2. **Shipper** posts load → POSTED (corridor auto-assigned) 3. **Dispatcher** views dispatch queue, proposes match to carrier's truck 4. **Carrier** accepts proposal → load ASSIGNED, trip created 5. **Carrier** starts trip → PICKUP_PENDING 6. **Carrier** picks up → IN_TRANSIT (GPS tracking active) 7. **Carrier** submits GPS positions along route 8. **Carrier** arrives at destination → DELIVERED 9. **Carrier** uploads POD document 10. **Shipper** confirms delivery → COMPLETED 11. Service fees deducted from both wallets 12. Verify: double-entry journal balanced, platform revenue credited |
| **Expected Result** | Complete lifecycle: Load DRAFT→POSTED→ASSIGNED→PICKUP_PENDING→IN_TRANSIT→DELIVERED→COMPLETED. Trip ASSIGNED→PICKUP_PENDING→IN_TRANSIT→DELIVERED→COMPLETED. Fees deducted. GPS route recorded. POD stored.                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Status**          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **Actual Result**   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |

---

### CROSS-002: Shipper-Led Matching (Truck Request Flow)

| Field               | Value                                                                                                                                                                                                                                                                                                                                                        |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Priority**        | P0                                                                                                                                                                                                                                                                                                                                                           |
| **Preconditions**   | Shipper with funded wallet, carrier with posted truck                                                                                                                                                                                                                                                                                                        |
| **Steps**           | 1. **Shipper** creates and posts load 2. **Shipper** browses truck postings (`GET /api/truck-postings`) 3. **Shipper** requests specific truck (`POST /api/truck-requests`) 4. **Carrier** receives notification of request 5. **Carrier** approves request → load ASSIGNED 6. **Carrier** executes trip through to COMPLETED 7. Verify service fees and POD |
| **Expected Result** | Shipper-initiated matching works end-to-end. No dispatcher involvement needed.                                                                                                                                                                                                                                                                               |
| **Status**          |                                                                                                                                                                                                                                                                                                                                                              |
| **Actual Result**   |                                                                                                                                                                                                                                                                                                                                                              |

---

### CROSS-003: Carrier-Led Matching (Load Request Flow)

| Field               | Value                                                                                                                                                                                                                                                                                                   |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**        | P0                                                                                                                                                                                                                                                                                                      |
| **Preconditions**   | Carrier with approved truck and funded wallet, shipper with posted load                                                                                                                                                                                                                                 |
| **Steps**           | 1. **Carrier** browses load board (`GET /api/loads?status=POSTED`) 2. **Carrier** requests load (`POST /api/load-requests`) 3. **Shipper** receives notification 4. **Shipper** approves request → load ASSIGNED 5. **Carrier** executes trip through to COMPLETED 6. Verify all financial transactions |
| **Expected Result** | Carrier-initiated matching works. Load assigned after shipper approval.                                                                                                                                                                                                                                 |
| **Status**          |                                                                                                                                                                                                                                                                                                         |
| **Actual Result**   |                                                                                                                                                                                                                                                                                                         |

---

### CROSS-004: Cancellation with Refund Flow

| Field               | Value                                                                                                                                                                                                                                                                                            |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Priority**        | P0                                                                                                                                                                                                                                                                                               |
| **Preconditions**   | Active trip (IN_TRANSIT), wallets have been validated                                                                                                                                                                                                                                            |
| **Steps**           | 1. Load is IN_TRANSIT 2. **Dispatcher** flags EXCEPTION on load 3. **Admin** reviews exception 4. **Admin** cancels load (EXCEPTION → CANCELLED) 5. Trip also cancelled 6. Verify: no service fees deducted (deduction only happens on completion), load returned to available state or terminal |
| **Expected Result** | Exception → cancellation flow works. No financial impact since fees only deduct on completion.                                                                                                                                                                                                   |
| **Status**          |                                                                                                                                                                                                                                                                                                  |
| **Actual Result**   |                                                                                                                                                                                                                                                                                                  |

---

### CROSS-005: Rejected Proposal → Re-match Flow

| Field               | Value                                                                                                                                                                                                                     |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**        | P1                                                                                                                                                                                                                        |
| **Preconditions**   | Posted load, two carriers with trucks                                                                                                                                                                                     |
| **Steps**           | 1. **Dispatcher** proposes match to Carrier A 2. **Carrier A** rejects proposal 3. Load returns to SEARCHING/POSTED 4. **Dispatcher** proposes match to Carrier B 5. **Carrier B** accepts 6. Trip proceeds to completion |
| **Expected Result** | Load survives rejection and gets re-matched successfully.                                                                                                                                                                 |
| **Status**          |                                                                                                                                                                                                                           |
| **Actual Result**   |                                                                                                                                                                                                                           |

---

### CROSS-006: Multi-Load Carrier (Sequential Trips)

| Field               | Value                                                                                                                                                                   |
| ------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**        | P1                                                                                                                                                                      |
| **Preconditions**   | Carrier with single truck, two posted loads                                                                                                                             |
| **Steps**           | 1. **Carrier** accepts first load, completes trip 2. Truck becomes available again 3. **Carrier** accepts second load (return load suggestion) 4. Completes second trip |
| **Expected Result** | Truck can perform sequential trips. After first completion, truck is available for new assignments.                                                                     |
| **Status**          |                                                                                                                                                                         |
| **Actual Result**   |                                                                                                                                                                         |

---

### CROSS-007: Registration → Verification → First Load

| Field               | Value                                                                                                                                                                                                                                                                                                                                         |
| ------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**        | P1                                                                                                                                                                                                                                                                                                                                            |
| **Preconditions**   | Fresh system (or clean test state)                                                                                                                                                                                                                                                                                                            |
| **Steps**           | 1. **New user** registers as shipper 2. **New user** creates organization 3. **New user** uploads company documents 4. **Admin** reviews and approves documents 5. **Admin** verifies organization 6. **Admin** activates user (REGISTERED → ACTIVE) 7. **Admin** tops up wallet 8. **Shipper** creates first load 9. Load posts successfully |
| **Expected Result** | Complete onboarding flow from registration to first load. All verification gates enforced.                                                                                                                                                                                                                                                    |
| **Status**          |                                                                                                                                                                                                                                                                                                                                               |
| **Actual Result**   |                                                                                                                                                                                                                                                                                                                                               |

---

### CROSS-008: Exception Handling with Resolution

| Field               | Value                                                                                                                                                                                                                                                                                       |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Priority**        | P1                                                                                                                                                                                                                                                                                          |
| **Preconditions**   | Load IN_TRANSIT with active trip                                                                                                                                                                                                                                                            |
| **Steps**           | 1. **Dispatcher** creates escalation (LATE_DELIVERY, priority: HIGH) 2. **Dispatcher** flags load as EXCEPTION 3. **Admin** reviews escalation 4. **Admin** resolves: EXCEPTION → IN_TRANSIT (issue resolved, continue journey) 5. **Carrier** completes delivery 6. Trip finishes normally |
| **Expected Result** | Exception flow allows pause and resume. Load continues after resolution. Financial impact only if exception leads to cancellation.                                                                                                                                                          |
| **Status**          |                                                                                                                                                                                                                                                                                             |
| **Actual Result**   |                                                                                                                                                                                                                                                                                             |
