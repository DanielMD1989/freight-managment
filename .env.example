# ============================================================================
# FREIGHT PLATFORM - ENVIRONMENT CONFIGURATION
# ============================================================================
# Version: 1.0.0
# Last Updated: 2026-01-22
#
# This file documents all environment variables used by the platform.
# Copy this file to .env.local for development or use AWS Secrets Manager
# for production.
#
# IMPORTANT: Never commit sensitive values to version control!
# ============================================================================

# ============================================================================
# APP CONFIGURATION
# ============================================================================

# Node environment: development | production | test
NODE_ENV="development"

# Server port
PORT="3000"

# Public URL of the application (used for emails, callbacks, etc.)
NEXT_PUBLIC_APP_URL="http://localhost:3000"

# Admin email address (for system notifications)
ADMIN_EMAIL="admin@freightplatform.com"

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# PostgreSQL connection URL (REQUIRED)
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=public
DATABASE_URL="postgresql://username:password@localhost:5432/freight_db?schema=public"

# Connection Pool Configuration
# Adjust based on expected load and available connections
#
# Development defaults: min=5, max=20
# Production defaults: min=10, max=100
# PgBouncer mode: min=2, max=10 (pooler handles main pooling)
DB_POOL_MIN="5"
DB_POOL_MAX="20"

# Health check interval in milliseconds (default: 30000 = 30 seconds)
DB_HEALTH_CHECK_INTERVAL_MS="30000"

# PgBouncer Configuration (recommended for production)
# Enable when using PgBouncer as connection pooler
PGBOUNCER_ENABLED="false"

# PgBouncer-specific settings (for docker-compose or k8s)
# DB_HOST="postgres"
# DB_PORT="5432"
# DB_NAME="freight_db"
# DB_USER="postgres"
# DB_PASSWORD=""

# ============================================================================
# AUTHENTICATION & SECURITY
# ============================================================================

# JWT Configuration (REQUIRED for production)
# Generate secrets with: openssl rand -base64 32
JWT_SECRET="development-jwt-secret-min-32-chars!"     # CHANGE IN PRODUCTION!
JWT_ENCRYPTION_KEY="dev-encrypt-key-32bytes-padding!" # CHANGE IN PRODUCTION!
JWT_EXPIRES_IN="7d"                                   # Token expiration
JWT_ENABLE_ENCRYPTION="true"                          # Enable A256GCM encryption

# NextAuth Configuration
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET=""  # Generate with: openssl rand -base64 32

# ============================================================================
# REDIS CONFIGURATION (Optional - Recommended for Production)
# ============================================================================

# Enable Redis for distributed rate limiting, caching, and sessions
# If REDIS_URL is set, Redis is automatically enabled
REDIS_ENABLED="false"

# Redis connection URL (preferred for production)
# Format: redis://[:password@]host:port[/database]
# REDIS_URL="redis://localhost:6379/0"

# Individual Redis settings (alternative to REDIS_URL)
REDIS_HOST="localhost"
REDIS_PORT="6379"
REDIS_PASSWORD=""
REDIS_DB="0"

# ============================================================================
# BACKGROUND QUEUE (BullMQ)
# ============================================================================

# Enable background job queue (requires Redis)
# If REDIS_ENABLED or REDIS_URL is set, queue is automatically enabled
QUEUE_ENABLED="false"

# Default job retry attempts
QUEUE_DEFAULT_ATTEMPTS="3"

# Backoff delay between retries (ms)
QUEUE_BACKOFF_DELAY="1000"

# ============================================================================
# STORAGE CONFIGURATION
# ============================================================================

# Storage provider: local | s3 | cloudinary
# - local: Store files on local disk (development only)
# - s3: Amazon S3 or compatible (recommended for production)
# - cloudinary: Cloudinary CDN (alternative for production)
STORAGE_PROVIDER="local"

# Local storage directory (relative to project root)
UPLOAD_DIR="uploads"

# AWS S3 Configuration
AWS_REGION="us-east-1"
AWS_ACCESS_KEY_ID=""
AWS_SECRET_ACCESS_KEY=""
AWS_S3_BUCKET=""

# CDN Configuration (Optional - for S3)
# Enable CloudFront or other CDN for file serving
CDN_ENABLED="false"
CDN_DOMAIN=""  # e.g., "cdn.yourplatform.com"

# Cloudinary Configuration (Alternative to S3)
CLOUDINARY_CLOUD_NAME=""
CLOUDINARY_API_KEY=""
CLOUDINARY_API_SECRET=""

# ============================================================================
# EMAIL CONFIGURATION
# ============================================================================

# Email provider: console | smtp | sendgrid | ses | resend
# - console: Log emails to console (development)
# - smtp: Use SMTP server (e.g., Gmail)
# - sendgrid: SendGrid API
# - ses: Amazon SES
# - resend: Resend API
EMAIL_PROVIDER="console"

# Email sender settings
EMAIL_FROM="noreply@freightplatform.com"
EMAIL_FROM_NAME="Freight Management Platform"

# SMTP Configuration (for EMAIL_PROVIDER=smtp)
SMTP_HOST="smtp.gmail.com"
SMTP_PORT="587"
SMTP_USER=""
SMTP_PASSWORD=""

# SendGrid Configuration (for EMAIL_PROVIDER=sendgrid)
SENDGRID_API_KEY=""

# Resend Configuration (for EMAIL_PROVIDER=resend)
RESEND_API_KEY=""

# ============================================================================
# SMS CONFIGURATION
# ============================================================================

# AfroMessage API (for Ethiopian SMS)
AFROMESSAGE_API_KEY=""
AFROMESSAGE_SENDER_NAME="FreightMgt"

# ============================================================================
# MONITORING & LOGGING
# ============================================================================

# Sentry Error Tracking (https://sentry.io)
# Get these values from your Sentry project settings
NEXT_PUBLIC_SENTRY_DSN=""     # Client-side DSN (public)
SENTRY_DSN=""                  # Server-side DSN
SENTRY_ORG=""                  # Your Sentry organization slug
SENTRY_PROJECT=""              # Your Sentry project slug
SENTRY_AUTH_TOKEN=""           # Auth token for source map uploads

# Monitoring Configuration
MONITORING_ENABLED="true"
MONITORING_API_KEY=""  # API key for external monitoring tools

# Alert Thresholds
ALERT_CPU_THRESHOLD="80"           # CPU usage % warning threshold
ALERT_MEMORY_THRESHOLD="85"        # Memory usage % warning threshold
ALERT_SLOW_QUERY_THRESHOLD_MS="1000"  # Slow query threshold in ms
ALERT_ERROR_RATE_THRESHOLD="5"     # Error rate % threshold
ALERT_EVENT_LOOP_THRESHOLD_MS="100"   # Event loop latency threshold

# Monitoring check interval (default: 60000 = 1 minute)
MONITORING_CHECK_INTERVAL_MS="60000"

# Logging Configuration
# Log level: debug | info | warn | error
LOG_LEVEL="info"

# Log format: json (production) | pretty (development)
LOG_FORMAT="pretty"

# Sample rate for high-volume debug logs (0-1, default: 1 = 100%)
LOG_SAMPLE_RATE="1"

# Enable request/response logging
LOG_REQUESTS="true"

# ============================================================================
# RATE LIMITING
# ============================================================================

# Enable rate limiting (recommended for production)
RATE_LIMIT_ENABLED="true"

# Secret key to bypass rate limits (for admin/testing)
RATE_LIMIT_BYPASS_KEY=""

# ============================================================================
# GPS & TRACKING
# ============================================================================

# GPS Server Configuration
GPS_SERVER_PORT="5001"
GPS_SERVER_HOST="0.0.0.0"

# ============================================================================
# MAPS & GEOCODING
# ============================================================================

# Google Maps API Key
# Enable: Places API, Maps JavaScript API, Geocoding API, Routes API
# Get from: https://console.cloud.google.com/apis/credentials
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=""

# Google Routes API Key (optional, falls back to GOOGLE_MAPS_API_KEY)
GOOGLE_ROUTES_API_KEY=""

# ============================================================================
# PAYMENT CONFIGURATION
# ============================================================================

# Chapa Payment Gateway (Ethiopia)
CHAPA_SECRET_KEY=""
CHAPA_PUBLIC_KEY=""
CHAPA_WEBHOOK_SECRET=""

# ============================================================================
# FEATURE FLAGS
# ============================================================================

# Feature flag provider: local | database | launchdarkly | unleash
# - local: In-memory flags (development/simple production)
# - database: Persist flags in PostgreSQL
# - launchdarkly: Use LaunchDarkly service
# - unleash: Use Unleash service
FEATURE_FLAG_PROVIDER="local"

# Cache TTL for feature flag evaluations (default: 60000 = 1 minute)
FEATURE_FLAG_CACHE_MS="60000"

# LaunchDarkly Configuration (if FEATURE_FLAG_PROVIDER=launchdarkly)
# LAUNCHDARKLY_SDK_KEY=""

# Unleash Configuration (if FEATURE_FLAG_PROVIDER=unleash)
# UNLEASH_URL="https://unleash.example.com/api"
# UNLEASH_API_KEY=""
# UNLEASH_APP_NAME="freight-platform"

# Legacy feature flags (still supported)
# Enable self-dispatch for carriers (without dispatcher)
ENABLE_SELF_DISPATCH="true"

# Enable real-time notifications (requires Redis)
ENABLE_NOTIFICATIONS="false"

# Require email verification for new users
ENABLE_EMAIL_VERIFICATION="false"

# ============================================================================
# AWS SECRETS MANAGER (Production)
# ============================================================================
# Use AWS Secrets Manager for sensitive configuration in production.
# Secrets from AWS will be merged with environment variables.
# Environment variables take precedence over secrets.

# Enable AWS Secrets Manager
SECRETS_MANAGER_ENABLED="false"

# Secret ID in AWS Secrets Manager
SECRETS_MANAGER_SECRET_ID="freight-platform/production"

# Cache TTL for secrets (default: 300000 = 5 minutes)
SECRETS_MANAGER_CACHE_MS="300000"

# ============================================================================
# DEVELOPMENT TOOLS
# ============================================================================

# Prisma
# PRISMA_HIDE_UPDATE_MESSAGE="1"  # Hide Prisma update notifications

# ============================================================================
# PRODUCTION CHECKLIST
# ============================================================================
# Before deploying to production, ensure:
#
# 1. DATABASE_URL points to production database
# 2. JWT_SECRET and JWT_ENCRYPTION_KEY are unique, random values
# 3. NEXTAUTH_SECRET is set
# 4. NODE_ENV="production"
# 5. REDIS_ENABLED="true" or REDIS_URL is set
# 6. STORAGE_PROVIDER="s3" with proper AWS credentials
# 7. EMAIL_PROVIDER is set with proper credentials
# 8. All API keys (Google Maps, Chapa, etc.) are production keys
# 9. LOG_FORMAT="json" for structured logging
# 10. SECRETS_MANAGER_ENABLED="true" for sensitive configs
# ============================================================================
